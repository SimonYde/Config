#!/usr/bin/env -S nu --no-config-file

use std/log

def on [ ] {
    hyprctl --batch ([
        "keyword animations:enabled 0",
        "keyword decoration:blur:enabled 0",
        "keyword general:gaps_in 0",
        "keyword general:gaps_out 0",
        "keyword general:border_size 1",
        "keyword decoration:rounding 0",
    ] | str join ";")
    log info "Disabled power hungry hyprland decorations"

    powerprofilesctl set power-saver
    log info "Set power profile to `power-saver`"
    systemctl --user stop hyprland-autoname-workspaces.service swww.service blueman-applet.service
    log info "Stopped certain user services"
    systemctl stop bluetooth.service
    log info "Disabled Bluetooth"
}

def main [state?: string] {
    match $state {
        "on" => {
            on
        }

        "off" => {
            hyprctl reload
            powerprofilesctl set balanced
            log info "Set power profile to `balanced`"
            systemctl --user start hyprland-autoname-workspaces.service swww.service blueman-applet.service
            log info "Enabled certain user services"
            systemctl start bluetooth.service
            log info "Enabled Bluetooth"
        }

        null => {
            on
        }
    }
}
